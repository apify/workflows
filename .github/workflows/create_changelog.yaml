name: create release

on:
  workflow_call:
    inputs:
      changelogScopes:
        description: 'Changelog scopes (i.e { "App": ["app", "application"] })'
        required: true
        type: string
      slackChannelId:
        description: Slack Channel ID
        required: false
        type: string
      releaseName:
        description: This value overrides release name got from release branch name
        required: false
        type: string
      releaseNamePrefix:
        description: Prepend prefix to releaseName
        required: false 
        type: string
        default: 'v'
    
    secrets:
      slackToken:
        description: Slack API token
        required: false

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: clone repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: get changelog
        id: changelog
        uses: apify/release-pr-action@feat/get_changelog_from_pr
        with: 
          slack-token: ${{ secrets.slackToken }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          changelog-scopes: ${{ inputs.changelogScopes }}
          release-name-prefix: ${{ inputs.releaseNamePrefix }}
          slack-channel: ${{ inputs.slackChannelId }}
          changelog-method: pull_request_description
          create-github-release: true
